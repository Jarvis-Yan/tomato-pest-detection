ğŸ“¦â€¯src ç›®å½•å¯åŠ¨æŒ‡å—

æœ¬æŒ‡å—é’ˆå¯¹ åµŒå…¥å¼æ¯”èµ›/src/ ç›®å½•ä¸‹çš„è¿è¡Œè„šæœ¬ï¼Œæ¦‚æ‹¬ ä¸€æ¬¡å†·å¯åŠ¨ åˆ° æ¨ç†è¿è¡Œ çš„å®Œæ•´æµç¨‹ã€‚

â¸»

0. å‰ç½®æ£€æŸ¥

é¡¹ç›®	é¢„æœŸ	è‡ªæ£€å‘½ä»¤
TFâ€‘Card æŒ‚è½½	/mnt/tfcard ä¸ /home/elf/tfcard åŒè·¯å¾„å¯è®¿é—®	`mount
Conda ç¯å¢ƒ	tomato å·²åˆ›å»ºï¼Œä½äº /home/elf/tfcard/conda/envs/tomato	conda env list
ä¾èµ–åŒ…	rknnâ€‘toolkitâ€‘lite2â€¯v2.1.0ã€opencvâ€‘pythonã€numpy==1.21.*â€¦	`conda activate tomato && pip list
æ¨¡å‹æ–‡ä»¶	models/yolov8.rknn æˆ– best.rknn å°±ä½	ls ../models/*.rknn
æ ‡ç­¾æ–‡ä»¶	classes.txt / synset_label.py	`cat ../data/classes.txt

è‹¥ä»»ä½•æ£€æŸ¥æœªé€šè¿‡ï¼Œè¯·å…ˆå›åˆ° README å¯¹åº”ç« èŠ‚å®Œæˆç¯å¢ƒé…ç½®ã€‚

â¸»

1. æ¿€æ´»è¿è¡Œç¯å¢ƒ

# ä»æ™®é€š shell
source ~/tfcard/conda/etc/profile.d/conda.sh  # è‹¥æœªå†™å…¥ ~/.bashrc
conda activate tomato

Tipï¼šè‹¥æ‚¨åœ¨ç³»ç»Ÿç›˜ç©ºé—´ä¸è¶³çš„æƒ…å†µä¸‹å®‰è£…äº† Miniforge/condaï¼Œè¯·ç¡®ä¿ conda/pkgs ä¸ envs å‡ä½äº TFâ€‘Cardï¼ˆext4ï¼‰å†…ï¼Œå¦åˆ™ä¼šå†æ¬¡è§¦å‘ â€œNo space left on deviceâ€ã€‚

â¸»

2. è¿è¡Œå•å¸§æµ‹è¯•

cd ~/tfcard/åµŒå…¥å¼æ¯”èµ›/src
python video.py rtsp://<camera_ip>/11   # å›¾å½¢çª—å£æµ‹è¯•ï¼ˆéœ€ X11/Wayland æ¡Œé¢ä¼šè¯ï¼‰

è‹¥æ²¡æœ‰æ¡Œé¢ç¯å¢ƒï¼Œå¯è¿è¡Œï¼š

python process_video_npu.py rtsp://<camera_ip>/11 --headless

æ­¤è„šæœ¬åœ¨æ§åˆ¶å°æ‰“å° FPS ä¸åˆ†ç±»ç»“æœï¼Œä¸æ‰“å¼€çª—å£ã€‚

â¸»

3. RTSP + æ¨ç† + ç»“æœä¸Šä¼ 

python stream_processor.py \
       --rtsp rtsp://192.168.0.101:554/11 \
       --server http://47.107.146.224:8000/ \
       --model ../models/yolov8.rknn \
       --labels ../data/classes.txt

å‚æ•°è¯´æ˜

é€‰é¡¹	å¿…å¡«	è¯´æ˜
--rtsp	âœ”	æ‘„åƒå¤´æˆ– NVR æµåœ°å€
--server	âœ”	Django åç«¯çš„æ ¹ URLï¼Œç”¨äº POST è¯†åˆ«ç»“æœ
--model	âœ–	é»˜è®¤ä¸º ../models/yolov8.rknn
--labels	âœ–	é»˜è®¤ä¸º ../data/classes.txt


â¸»

4. å¸¸è§é—®é¢˜

a. ModuleNotFoundError: rknnlite
	â€¢	æœªæ¿€æ´» conda ç¯å¢ƒæˆ– PYTHONPATH æœªåŒ…å« TFâ€‘Card siteâ€‘packagesã€‚

b. Unsupport data format: NCHW/NHWC
	â€¢	æ¨¡å‹å¯¼å‡ºæ—¶ä¸ preprocess() å½¢çŠ¶/ç±»å‹ä¸åŒ¹é…ã€‚ç¡®è®¤ï¼š
	1.	input_layout åœ¨ RKNN converter å†…è®¾ç½®ä¸ä»£ç ä¸€è‡´ã€‚
	2.	inp = img.astype(np.float32) æˆ– uint8 ä¸æ¨¡å‹é‡åŒ–æ–¹å¼ä¸€è‡´ã€‚

c. rknn model version 2.3.0 not match runtime 2.1.0
	â€¢	æ¨¡å‹éœ€ä½¿ç”¨ rknnâ€‘toolkitâ€‘lite2==2.1.0ï¼ˆæˆ–å‡çº§è¿è¡Œæ—¶è‡³ 2.3.0ï¼‰ã€‚

â¸»

5. ä¸€é”®è„šæœ¬ï¼ˆå¯é€‰ï¼‰

åœ¨ scripts/launch.sh ä¸­æä¾›äº†ç¤ºä¾‹ï¼š

#!/usr/bin/env bash
source ~/tfcard/conda/etc/profile.d/conda.sh
conda activate tomato
cd ~/tfcard/åµŒå…¥å¼æ¯”èµ›/src
python stream_processor.py "$@"

èµ‹äºˆæ‰§è¡Œæƒé™ï¼šchmod +x scripts/launch.shã€‚
ç„¶åï¼š./scripts/launch.sh --rtsp ...ã€‚

â¸»

ç»´æŠ¤ï¼šæœ¬æŒ‡å—ç”± ChatGPT ç”Ÿæˆå¹¶éšé¡¹ç›®è¿­ä»£æ›´æ–°ï¼›å¦‚éœ€ä¿®æ”¹ï¼Œåœ¨ Canvas ä¸­ç›´æ¥ç¼–è¾‘åé€šçŸ¥æˆ‘å³å¯ã€‚